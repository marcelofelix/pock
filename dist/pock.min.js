"use strict";angular.module("pockApp",["ngRoute","ngMaterial","ui-notification","ui.utils.masks","ngFileUpload","templates"]).config(["$routeProvider","$httpProvider","$mdThemingProvider",function(t,e,n){e.interceptors.push("httpLoading"),t.when("/",{templateUrl:"home/home.html"}).when("/product",{templateUrl:"product/product-list.html",controller:"ProductListController",controllerAs:"vm",resolve:{products:function(t){return t.list()}}}).when("/product/new",{templateUrl:"product/product.html",controller:"ProductController",controllerAs:"vm",resolve:{product:function(t){return{}}}}).when("/product/:code",{templateUrl:"product/product.html",controller:"ProductController",controllerAs:"vm",resolve:{product:function(t,e){return e.get(t.current.params.code)}}}).when("/purchase",{templateUrl:"purchase/purchase-list.html",controller:"PurchaseListController",controllerAs:"vm",resolve:{purchases:function(t){return t.list()}}}).when("/purchase/:id",{templateUrl:"purchase/purchase.html",controller:"PurchaseController",controllerAs:"vm",resolve:{purchase:function(t,e){return e.get(t.current.params.id)}}}).when("/sell",{templateUrl:"sell/sell-list.html",controller:"SellListController",controllerAs:"vm",resolve:{sells:function(t){return t.list(moment().startOf("month").toDate(),moment().endOf("month").toDate())}}}).when("/sell/:id",{templateUrl:"sell/sell.html",controller:"SellController",controllerAs:"vm",resolve:{sell:function(t,e){return t.get(e.current.params.id)},products:function(t){return t.list()}}})}]),angular.module("pockApp").directive("currency",function(){return{require:"ngModel",link:function(t,e,n,r){r.$parsers.push(function(t){return""+t}),r.$formatters.push(function(t){return parseFloat(t,10)})}}}),angular.module("pockApp").controller("PurchaseListController",["purchases","Upload","$location","PurchaseService","Menu",function(t,e,n,r,o){o.action="Compras";var l=this;return l.purchases=t,l.uploadFiles=function(t,n){t&&(t.upload=e.upload({url:"purchase/import",data:{file:t}}),t.upload.then(r.list().then(function(t){l.purchases=t})))},l.show=function(t){n.path("/purchase/"+t.id)},l}]),angular.module("pockApp").factory("PurchaseService",["$http",function(t){return{list:function(){return t({url:"purchase",method:"GET"}).then(function(t){return t.data},{})},get:function(e){return t({url:"purchase/"+e,method:"GET"}).then(function(t){return t.data},{})}}}]);var app=angular.module("pockApp");app.controller("PurchaseController",["purchase","Menu",function(t,e){e.action="Compras";var n=this;return n.purchase=t,n}]),angular.module("pockApp").factory("httpLoading",["$rootScope",function(t){return{request:function(e){return t.loading=!0,e},response:function(e){return t.loading=!1,e}}}]),function(){function t(t,e){var n=this;n.menu=e}angular.module("pockApp").controller("HomeController",t)}(),angular.module("pockApp").controller("ProductListController",["products","$location","Menu",function(t,e,n){n.action="Produtos";var r=this;return r.products=t,r.edit=function(t){e.path("product/"+t.ean)},r.search=function(t){return _.filter(r.products,function(e){return angular.lowercase(e.name).indexOf(angular.lowercase(t))>-1})},r}]),function(){function t(t,e,n,r,o,l){function u(){r.suppliers().then(function(t){a.suppliers=t})}function c(){t.productForm.$invalid||r.save(a.product).then(function(){n.path("product"),o("Produto salvo com sucesso")})}l.action="Novo produto";var a=this;a.product=e,a.save=c,u()}angular.module("pockApp").controller("ProductController",t)}(),function(){function t(t){function e(e){return t.get("/products/"+e).then(function(t){return t.data})}function n(){return t.get("products").then(function(t){return t.data})}function r(e){return e.id?t.put("products/"+e.id,e):t.post("products",e)}function o(){return t.get("supplier").then(function(t){return t.data})}return{get:e,list:n,save:r,suppliers:o}}angular.module("pockApp").factory("ProductService",t)}(),angular.module("pockApp").controller("SellListController",["$scope","sells","SellService","$location","Menu",function(t,e,n,r,o){o.action="Vendas";var l=this;return l.sells=e,l.startDate=moment().startOf("month").toDate(),l.endDate=moment().endOf("month").toDate(),l.total=0,l.list=function(){n.list(l.startDate,l.endDate).then(function(t){l.sells=t},{})},l.total=function(){return _.reduce(l.sells,function(t,e){return t+parseFloat(e.total)},0)},l.edit=function(t){r.path("/sell/"+t)},l.newSell=function(){n.newSell().then(function(t){r.path("/sell/"+t.id)},{})},this}]),function(){function t(t,e,n,r,o,l){function u(){n.cancel(k.sell.id).then(function(){o.path("/sell")})}function c(t){return _.filter(k.products,function(e){return angular.lowercase(e.name).indexOf(angular.lowercase(t))>-1})}function a(t){t&&(n.add(k.sell.id,t.id).then(function(t){p(t)}),k.searchText="")}function i(t){if(t){var e=t.discount?t.price*t.discount/100:0;return(t.price-e)*t.count}}function s(t){k.item=_.clone(t),r(S).toggle()}function p(t){n.updateItem(k.sell.id,t).then(function(t){var e=_.find(k.itens,{product_id:t.product_id});e?_.assign(e,t):k.itens.unshift(t),k.closeItem()},{})}function d(){k.totalSell(),r(w).toggle()}function f(){r(S).close()}function h(){r(w).close()}function m(){var t=_.reduce(k.itens,function(t,e){return t+k.total(e)},0),e=k.sell.discount?t*k.sell.discount/100:0;return t-e}function v(t){n.removeItem(t.id).then(function(){_.remove(k.itens,{id:t.id}),k.closeItem()},{})}function g(){return k.sell.payment>k.totalSell()?k.sell.payment-k.totalSell():0}function P(){var t=_.clone(k.sell);t.status="close",n.update(t).then(function(e){t.status="close",o.path("/sell")},{})}function A(){k.sell.created_at=k.date,n.update(k.sell)}l.action="Nova Venda";var S="item",w="payment",k=this;k.sell=t,k.itens=t.sell_items,k.date=moment(t.created_at).toDate(),k.products=e,k.search=c,k.add=a,k.total=i,k.openItem=s,k.openPayment=d,k.closeItem=f,k.closePayment=h,k.totalSell=m,k.remove=v,k.charge=g,k.updateItem=p,k.close=P,k.update=A,k.cancel=u}angular.module("pockApp").controller("SellController",t)}(),function(){angular.module("pockApp").factory("SellService",["$http",function(t){function e(e,n){return t({url:"sell",method:"GET",params:{start:e,end:n}}).then(function(t){return t.data},{})}function n(e){return t({url:"sell/"+e,method:"GET"}).then(function(t){return t.data},{})}function r(){return t({url:"sell",method:"POST"}).then(function(t){return t.data},{})}function o(e,n){return t({url:"sell/"+e+"/item",method:"POST",params:{product_id:n}}).then(function(t){return t.data},{})}function l(e,n){return t({url:"/sell/"+e+"/item/",method:"PUT",data:{item:n}}).then(function(t){return t.data},{})}function u(e){return t({url:"sell/item/"+e,method:"DELETE"})}function c(e){return t({url:"sell/"+e.id,method:"PUT",data:{sell:e}}).then(function(t){return t.data},{})}function a(e){return t({url:"sell/"+e,method:"DELETE"})}return{list:e,get:n,newSell:r,add:o,updateItem:l,removeItem:u,update:c,cancel:a}}])}(),function(){function t(){return console.log("MenuAction"),{action:"Lista de produtos"}}angular.module("pockApp").factory("Menu",t)}(),angular.module("pockApp",["ngRoute","ngMaterial","ui-notification","ui.utils.masks","ngFileUpload","templates"]).config(["$routeProvider","$httpProvider","$mdThemingProvider",function(t,e,n){e.interceptors.push("httpLoading"),t.when("/",{templateUrl:"home/home.html"}).when("/product",{templateUrl:"product/product-list.html",controller:"ProductListController",controllerAs:"vm",resolve:{products:function(t){return t.list()}}}).when("/product/new",{templateUrl:"product/product.html",controller:"ProductController",controllerAs:"vm",resolve:{product:function(t){return{}}}}).when("/product/:code",{templateUrl:"product/product.html",controller:"ProductController",controllerAs:"vm",resolve:{product:function(t,e){return e.get(t.current.params.code)}}}).when("/purchase",{templateUrl:"purchase/purchase-list.html",controller:"PurchaseListController",controllerAs:"vm",resolve:{purchases:function(t){return t.list()}}}).when("/purchase/:id",{templateUrl:"purchase/purchase.html",controller:"PurchaseController",controllerAs:"vm",resolve:{purchase:function(t,e){return e.get(t.current.params.id)}}}).when("/sell",{templateUrl:"sell/sell-list.html",controller:"SellListController",controllerAs:"vm",resolve:{sells:function(t){return t.list(moment().startOf("month").toDate(),moment().endOf("month").toDate())}}}).when("/sell/:id",{templateUrl:"sell/sell.html",controller:"SellController",controllerAs:"vm",resolve:{sell:function(t,e){return t.get(e.current.params.id)},products:function(t){return t.list()}}})}]),angular.module("pockApp").directive("currency",function(){return{require:"ngModel",link:function(t,e,n,r){r.$parsers.push(function(t){return""+t}),r.$formatters.push(function(t){return parseFloat(t,10)})}}}),function(){function t(t,e){var n=this;n.menu=e}angular.module("pockApp").controller("HomeController",t)}(),angular.module("pockApp").factory("httpLoading",["$rootScope",function(t){return{request:function(e){return t.loading=!0,e},response:function(e){return t.loading=!1,e}}}]),angular.module("pockApp").controller("ProductListController",["products","$location","Menu",function(t,e,n){n.action="Produtos";var r=this;return r.products=t,r.edit=function(t){e.path("product/"+t.ean)},r.search=function(t){return _.filter(r.products,function(e){return angular.lowercase(e.name).indexOf(angular.lowercase(t))>-1})},r}]),function(){function t(t,e,n,r,o,l){function u(){r.suppliers().then(function(t){a.suppliers=t})}function c(){t.productForm.$invalid||r.save(a.product).then(function(){n.path("product"),o("Produto salvo com sucesso")})}l.action="Novo produto";var a=this;a.product=e,a.save=c,u()}angular.module("pockApp").controller("ProductController",t)}(),function(){function t(t){function e(e){return t.get("/products/"+e).then(function(t){return t.data})}function n(){return t.get("products").then(function(t){return t.data})}function r(e){return e.id?t.put("products/"+e.id,e):t.post("products",e)}function o(){return t.get("supplier").then(function(t){return t.data})}return{get:e,list:n,save:r,suppliers:o}}angular.module("pockApp").factory("ProductService",t)}(),angular.module("pockApp").controller("PurchaseListController",["purchases","Upload","$location","PurchaseService","Menu",function(t,e,n,r,o){o.action="Compras";var l=this;return l.purchases=t,l.uploadFiles=function(t,n){t&&(t.upload=e.upload({url:"purchase/import",data:{file:t}}),t.upload.then(r.list().then(function(t){l.purchases=t})))},l.show=function(t){n.path("/purchase/"+t.id)},l}]),angular.module("pockApp").factory("PurchaseService",["$http",function(t){return{list:function(){return t({url:"purchase",method:"GET"}).then(function(t){return t.data},{})},get:function(e){return t({url:"purchase/"+e,method:"GET"}).then(function(t){return t.data},{})}}}]);var app=angular.module("pockApp");app.controller("PurchaseController",["purchase","Menu",function(t,e){e.action="Compras";var n=this;return n.purchase=t,n}]),angular.module("pockApp").controller("SellListController",["$scope","sells","SellService","$location","Menu",function(t,e,n,r,o){o.action="Vendas";var l=this;return l.sells=e,l.startDate=moment().startOf("month").toDate(),l.endDate=moment().endOf("month").toDate(),l.total=0,l.list=function(){n.list(l.startDate,l.endDate).then(function(t){l.sells=t},{})},l.total=function(){return _.reduce(l.sells,function(t,e){return t+parseFloat(e.total)},0)},l.edit=function(t){r.path("/sell/"+t)},l.newSell=function(){n.newSell().then(function(t){r.path("/sell/"+t.id)},{})},this}]),function(){function t(t,e,n,r,o,l){function u(){n.cancel(k.sell.id).then(function(){o.path("/sell")})}function c(t){return _.filter(k.products,function(e){return angular.lowercase(e.name).indexOf(angular.lowercase(t))>-1})}function a(t){t&&(n.add(k.sell.id,t.id).then(function(t){p(t)}),k.searchText="")}function i(t){if(t){var e=t.discount?t.price*t.discount/100:0;return(t.price-e)*t.count}}function s(t){k.item=_.clone(t),r(S).toggle()}function p(t){n.updateItem(k.sell.id,t).then(function(t){var e=_.find(k.itens,{product_id:t.product_id});e?_.assign(e,t):k.itens.unshift(t),k.closeItem()},{})}function d(){k.totalSell(),r(w).toggle()}function f(){r(S).close()}function h(){r(w).close()}function m(){var t=_.reduce(k.itens,function(t,e){return t+k.total(e)},0),e=k.sell.discount?t*k.sell.discount/100:0;return t-e}function v(t){n.removeItem(t.id).then(function(){_.remove(k.itens,{id:t.id}),k.closeItem()},{})}function g(){return k.sell.payment>k.totalSell()?k.sell.payment-k.totalSell():0}function P(){var t=_.clone(k.sell);t.status="close",n.update(t).then(function(e){t.status="close",o.path("/sell")},{})}function A(){k.sell.created_at=k.date,n.update(k.sell)}l.action="Nova Venda";var S="item",w="payment",k=this;k.sell=t,k.itens=t.sell_items,k.date=moment(t.created_at).toDate(),k.products=e,k.search=c,k.add=a,k.total=i,k.openItem=s,k.openPayment=d,k.closeItem=f,k.closePayment=h,k.totalSell=m,k.remove=v,k.charge=g,k.updateItem=p,k.close=P,k.update=A,k.cancel=u}angular.module("pockApp").controller("SellController",t)}(),function(){angular.module("pockApp").factory("SellService",["$http",function(t){function e(e,n){return t({url:"sell",method:"GET",params:{start:e,end:n}}).then(function(t){return t.data},{})}function n(e){return t({url:"sell/"+e,method:"GET"}).then(function(t){return t.data},{})}function r(){return t({url:"sell",method:"POST"}).then(function(t){return t.data},{})}function o(e,n){return t({url:"sell/"+e+"/item",method:"POST",params:{product_id:n}}).then(function(t){return t.data},{})}function l(e,n){return t({url:"/sell/"+e+"/item/",method:"PUT",data:{item:n}}).then(function(t){return t.data},{})}function u(e){return t({url:"sell/item/"+e,method:"DELETE"})}function c(e){return t({url:"sell/"+e.id,method:"PUT",data:{sell:e}}).then(function(t){return t.data},{})}function a(e){return t({url:"sell/"+e,method:"DELETE"})}return{list:e,get:n,newSell:r,add:o,updateItem:l,removeItem:u,update:c,cancel:a}}])}(),function(){function t(){return console.log("MenuAction"),{action:"Lista de produtos"}}angular.module("pockApp").factory("Menu",t)}();